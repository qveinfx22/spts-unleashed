local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")

local player = Players.LocalPlayer
local backpack = player:WaitForChild("Backpack")
local character = player.Character or player.CharacterAdded:Wait()
local rootPart = character:WaitForChild("HumanoidRootPart")

-- GUI
local gui = Instance.new("ScreenGui", player:WaitForChild("PlayerGui"))
gui.Name = "SPTS_GUI"
gui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
gui.ResetOnSpawn = false

-- Главный фрейм
local frame = Instance.new("Frame", gui)
frame.Size = UDim2.new(0, 480, 0, 360)
frame.Position = UDim2.new(0.5, -240, 0.5, -180)
frame.BackgroundColor3 = Color3.fromRGB(20, 20, 30)
frame.Active = true
frame.Draggable = true
frame.BackgroundTransparency = 1
Instance.new("UICorner", frame).CornerRadius = UDim.new(0, 12)

TweenService:Create(frame, TweenInfo.new(0.5, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), {
    BackgroundTransparency = 0
}):Play()

-- Хедер
local header = Instance.new("TextLabel", frame)
header.Size = UDim2.new(1, 0, 0, 50)
header.Text = "SPTS AutoFarm"
header.Font = Enum.Font.GothamBold
header.TextSize = 20
header.TextColor3 = Color3.fromRGB(90, 160, 255)
header.BackgroundColor3 = Color3.fromRGB(30, 30, 45)
Instance.new("UICorner", header).CornerRadius = UDim.new(0, 12)

-- Кнопка закрытия
local close = Instance.new("TextButton", frame)
close.Size = UDim2.new(0, 30, 0, 30)
close.Position = UDim2.new(1, -35, 0, 10)
close.Text = "X"
close.BackgroundColor3 = Color3.fromRGB(180, 50, 50)
close.TextColor3 = Color3.new(1, 1, 1)
close.Font = Enum.Font.GothamBold
close.TextSize = 14
Instance.new("UICorner", close).CornerRadius = UDim.new(1, 0)

-- Кнопка свернуть/развернуть
local minimize = Instance.new("TextButton", frame)
minimize.Size = UDim2.new(0, 30, 0, 30)
minimize.Position = UDim2.new(1, -70, 0, 10)
minimize.Text = "—"
minimize.BackgroundColor3 = Color3.fromRGB(100, 100, 130)
minimize.TextColor3 = Color3.new(1, 1, 1)
minimize.Font = Enum.Font.GothamBold
minimize.TextSize = 20
Instance.new("UICorner", minimize).CornerRadius = UDim.new(1, 0)

-- Левая панель категорий
local sidebar = Instance.new("Frame", frame)
sidebar.Size = UDim2.new(0, 140, 1, -50)
sidebar.Position = UDim2.new(0, 0, 0, 50)
sidebar.BackgroundColor3 = Color3.fromRGB(30, 30, 45)
Instance.new("UICorner", sidebar).CornerRadius = UDim.new(0, 12)

local sidebarTitle = Instance.new("TextLabel", sidebar)
sidebarTitle.Text = "Categories"
sidebarTitle.Font = Enum.Font.GothamBold
sidebarTitle.TextSize = 16
sidebarTitle.TextColor3 = Color3.fromRGB(150, 170, 255)
sidebarTitle.BackgroundTransparency = 1
sidebarTitle.Size = UDim2.new(1, 0, 0, 30)
sidebarTitle.Position = UDim2.new(0, 0, 0, 10)

local function createSidebarButton(text, posY)
    local btn = Instance.new("TextButton", sidebar)
    btn.Size = UDim2.new(1, -20, 0, 40)
    btn.Position = UDim2.new(0, 10, 0, posY)
    btn.BackgroundColor3 = Color3.fromRGB(40, 40, 60)
    btn.TextColor3 = Color3.fromRGB(200, 200, 255)
    btn.Font = Enum.Font.Gotham
    btn.TextSize = 14
    btn.Text = text
    Instance.new("UICorner", btn).CornerRadius = UDim.new(0, 8)
    return btn
end

-- Контейнер контента справа
local content = Instance.new("Frame", frame)
content.Position = UDim2.new(0, 150, 0, 50)
content.Size = UDim2.new(0, 330, 1, -50)
content.BackgroundTransparency = 1

-- Категории содержимого
local categoryFrames = {}

local function createCategoryFrame(name)
    local f = Instance.new("Frame", content)
    f.Size = UDim2.new(1, 0, 1, 0)
    f.BackgroundTransparency = 1
    f.Visible = false
    categoryFrames[name] = f
    return f
end

-- Создаем категории
local skillCategory = createCategoryFrame("Skills")
local farmAreaCategory = createCategoryFrame("Farm Area")

-- По умолчанию показываем Skills
skillCategory.Visible = true

-- Кнопки переключения категорий
local btnSkills = createSidebarButton("Skills", 50)
local btnFarmArea = createSidebarButton("Farm Area", 100)

btnSkills.MouseButton1Click:Connect(function()
    for _, frameC in pairs(categoryFrames) do frameC.Visible = false end
    skillCategory.Visible = true
end)

btnFarmArea.MouseButton1Click:Connect(function()
    for _, frameC in pairs(categoryFrames) do frameC.Visible = false end
    farmAreaCategory.Visible = true
end)

-- === Skills Category ===

local skills = {
    ["Fist Strength"] = false,
    ["Body Toughness"] = false,
    ["Psychic Power"] = false
}
local activeCount = 0

local function createToggle(skillName, parent, yPosition)
    local holder = Instance.new("Frame", parent)
    holder.Size = UDim2.new(0, 320, 0, 40)
    holder.Position = UDim2.new(0, 10, 0, yPosition)
    holder.BackgroundTransparency = 1

    local label = Instance.new("TextLabel", holder)
    label.Size = UDim2.new(1, -70, 1, 0)
    label.Position = UDim2.new(0, 0, 0, 0)
    label.Text = skillName
    label.TextColor3 = Color3.new(1, 1, 1)
    label.BackgroundTransparency = 1
    label.Font = Enum.Font.Gotham
    label.TextSize = 16
    label.TextXAlignment = Enum.TextXAlignment.Left

    local switch = Instance.new("Frame", holder)
    switch.Size = UDim2.new(0, 50, 0, 25)
    switch.Position = UDim2.new(1, -60, 0.5, -12)
    switch.BackgroundColor3 = Color3.fromRGB(80, 80, 100)
    Instance.new("UICorner", switch).CornerRadius = UDim.new(1, 0)

    local thumb = Instance.new("Frame", switch)
    thumb.Size = UDim2.new(0, 20, 0, 20)
    thumb.Position = UDim2.new(0, 3, 0.5, -10)
    thumb.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    Instance.new("UICorner", thumb).CornerRadius = UDim.new(1, 0)

    local function toggle()
        if skills[skillName] then
            skills[skillName] = false
            activeCount -= 1
            TweenService:Create(thumb, TweenInfo.new(0.2), {Position = UDim2.new(0, 3, 0.5, -10)}):Play()
            switch.BackgroundColor3 = Color3.fromRGB(80, 80, 100)
        elseif activeCount < 3 then
            skills[skillName] = true
            activeCount += 1
            TweenService:Create(thumb, TweenInfo.new(0.2), {Position = UDim2.new(1, -23, 0.5, -10)}):Play()
            switch.BackgroundColor3 = Color3.fromRGB(60, 180, 90)
        end
    end

    switch.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            toggle()
        end
    end)
end

createToggle("Fist Strength", skillCategory, 20)
createToggle("Body Toughness", skillCategory, 70)
createToggle("Psychic Power", skillCategory, 120)

-- Фарминговая кнопка в Skills
local toggleFarm = Instance.new("TextButton", skillCategory)
toggleFarm.Size = UDim2.new(0, 320, 0, 45)
toggleFarm.Position = UDim2.new(0, 10, 0, 180)
toggleFarm.BackgroundColor3 = Color3.fromRGB(90, 130, 255)
toggleFarm.TextColor3 = Color3.new(1, 1, 1)
toggleFarm.Font = Enum.Font.GothamBold
toggleFarm.TextSize = 16
toggleFarm.Text = "[ ] Start Farming"
Instance.new("UICorner", toggleFarm).CornerRadius = UDim.new(0, 10)

local farming = false
local farmConnection = nil

local function stopFarming()
    if farmConnection then
        farmConnection:Disconnect()
        farmConnection = nil
    end
    farming = false
    toggleFarm.Text = "[ ] Start Farming"
    toggleFarm.BackgroundColor3 = Color3.fromRGB(90, 130, 255)
end

toggleFarm.MouseButton1Click:Connect(function()
    farming = not farming
    toggleFarm.Text = farming and "[✔] Farming Active" or "[ ] Start Farming"
    toggleFarm.BackgroundColor3 = farming and Color3.fromRGB(40, 160, 60) or Color3.fromRGB(90, 130, 255)

    if farming then
        farmConnection = RunService.Heartbeat:Connect(function()
            for _, tool in ipairs(backpack:GetChildren()) do
                for skill, isEnabled in pairs(skills) do
                    if isEnabled and tool.Name:lower():find(skill:lower()) then
                        tool.Parent = character
                        pcall(function() tool:Activate() end)
                        wait(0.1)
                        tool.Parent = backpack
                    end
                end
            end
        end)
    else
        stopFarming()
    end
end)

-- Кнопка телепортации к ближайшему сундуку в Skills
local toggleChestFarm = Instance.new("TextButton", skillCategory)
toggleChestFarm.Size = UDim2.new(0, 320, 0, 45)
toggleChestFarm.Position = UDim2.new(0, 10, 0, 240)
toggleChestFarm.BackgroundColor3 = Color3.fromRGB(90, 130, 255)
toggleChestFarm.TextColor3 = Color3.new(1, 1, 1)
toggleChestFarm.Font = Enum.Font.GothamBold
toggleChestFarm.TextSize = 16
toggleChestFarm.Text = "Teleport to Nearest Chest"
Instance.new("UICorner", toggleChestFarm).CornerRadius = UDim.new(0, 10)

toggleChestFarm.MouseButton1Click:Connect(function()
    local nearestChest = nil
    local nearestDistance = math.huge
    for _, obj in ipairs(workspace:GetDescendants()) do
        if obj:IsA("BasePart") and (obj.Name:lower():find("chest")) then
            local dist = (rootPart.Position - obj.Position).Magnitude
            if dist < nearestDistance then
                nearestDistance = dist
                nearestChest = obj
            end
        end
    end
    if nearestChest then
        rootPart.CFrame = CFrame.new(nearestChest.Position + Vector3.new(0, 3, 0))
    else
        warn("No chest found nearby")
    end
end)

-- === Farm Area Category ===

local btn200QadPP = Instance.new("TextButton", farmAreaCategory)
btn200QadPP.Size = UDim2.new(0, 320, 0, 45)
btn200QadPP.Position = UDim2.new(0, 10, 0, 20)
btn200QadPP.BackgroundColor3 = Color3.fromRGB(90, 130, 255)
btn200QadPP.TextColor3 = Color3.new(1, 1, 1)
btn200QadPP.Font = Enum.Font.GothamBold
btn200QadPP.TextSize = 16
btn200QadPP.Text = "200Qad PP Area"
Instance.new("UICorner", btn200QadPP).CornerRadius = UDim.new(0, 10)

btn200QadPP.MouseButton1Click:Connect(function()
    rootPart.CFrame = CFrame.new(-2046, 15484, -1867)
end)

-- Состояние свернутости окна
local isMinimized = false

minimize.MouseButton1Click:Connect(function()
    isMinimized = not isMinimized
    if isMinimized then
        -- Свернуть: скрываем все кроме хедера и кнопок
        sidebar.Visible = false
        content.Visible = false
        frame.Size = UDim2.new(0, 480, 0, 50)
        minimize.Text = "+"
    else
        -- Развернуть
        sidebar.Visible = true
        content.Visible = true
        frame.Size = UDim2.new(0, 480, 0, 360)
        minimize.Text = "—"
    end
end)

close.MouseButton1Click:Connect(function()
    stopFarming()
    gui:Destroy()
end)
-- ...весь предыдущий код без изменений...

-- Дополнительно: Создаём 2 панели справа сверху для отображения координат

local coordsGui = Instance.new("ScreenGui", player:WaitForChild("PlayerGui"))
coordsGui.Name = "Coordinates_GUI"
coordsGui.ResetOnSpawn = false
coordsGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

local function createCoordFrame(posX, posY, title)
    local frame = Instance.new("Frame", coordsGui)
    frame.Size = UDim2.new(0, 180, 0, 40)
    frame.Position = UDim2.new(1, -posX, 0, posY)
    frame.BackgroundColor3 = Color3.fromRGB(20, 20, 30)
    frame.BackgroundTransparency = 0.8
    frame.BorderSizePixel = 0
    Instance.new("UICorner", frame).CornerRadius = UDim.new(0, 8)

    local titleLabel = Instance.new("TextLabel", frame)
    titleLabel.Size = UDim2.new(1, -10, 0, 18)
    titleLabel.Position = UDim2.new(0, 5, 0, 2)
    titleLabel.Text = title
    titleLabel.TextColor3 = Color3.fromRGB(150, 180, 255)
    titleLabel.BackgroundTransparency = 1
    titleLabel.Font = Enum.Font.GothamBold
    titleLabel.TextSize = 14
    titleLabel.TextXAlignment = Enum.TextXAlignment.Left

    local valueLabel = Instance.new("TextLabel", frame)
    valueLabel.Size = UDim2.new(1, -10, 0, 18)
    valueLabel.Position = UDim2.new(0, 5, 0, 20)
    valueLabel.Text = "Loading..."
    valueLabel.TextColor3 = Color3.new(1, 1, 1)
    valueLabel.BackgroundTransparency = 1
    valueLabel.Font = Enum.Font.Gotham
    valueLabel.TextSize = 14
    valueLabel.TextXAlignment = Enum.TextXAlignment.Left

    return frame, valueLabel
end

local playerCoordFrame, playerCoordLabel = createCoordFrame(200, 10, "Player Coordinates")
local rootPartCoordFrame, rootPartCoordLabel = createCoordFrame(200, 60, "RootPart Coordinates")

-- Обновление координат каждую 1/10 секунды
RunService.Heartbeat:Connect(function()
    if character and character.Parent then
        local pos = character.PrimaryPart and character.PrimaryPart.Position or rootPart.Position
        playerCoordLabel.Text = string.format("X: %.1f  Y: %.1f  Z: %.1f", pos.X, pos.Y, pos.Z)
    else
        playerCoordLabel.Text = "No Character"
    end

    if rootPart and rootPart.Parent then
        local rp = rootPart.Position
        rootPartCoordLabel.Text = string.format("X: %.1f  Y: %.1f  Z: %.1f", rp.X, rp.Y, rp.Z)
    else
        rootPartCoordLabel.Text = "No RootPart"
    end
end)

-- ...остальной ваш код...

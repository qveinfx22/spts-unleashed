local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")
local player = Players.LocalPlayer
local backpack = player:WaitForChild("Backpack")
local character = player.Character or player.CharacterAdded:Wait()
local humanoidRootPart = character:WaitForChild("HumanoidRootPart")

-- Create GUI
local gui = Instance.new("ScreenGui", player:WaitForChild("PlayerGui"))
gui.Name = "SPTS_GUI"
gui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
gui.ResetOnSpawn = false

-- Main Frame
local frame = Instance.new("Frame", gui)
frame.Size = UDim2.new(0, 420, 0, 360)
frame.Position = UDim2.new(0.5, -210, 0.5, -180)
frame.BackgroundColor3 = Color3.fromRGB(20, 20, 30)
frame.Active = true
frame.Draggable = true
frame.BackgroundTransparency = 1
Instance.new("UICorner", frame).CornerRadius = UDim.new(0, 12)

-- Animate GUI on spawn
TweenService:Create(frame, TweenInfo.new(0.5, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), {
    BackgroundTransparency = 0
}):Play()

-- Header
local header = Instance.new("TextLabel", frame)
header.Size = UDim2.new(1, 0, 0, 50)
header.Text = "SPTS AutoFarm"
header.Font = Enum.Font.GothamBold
header.TextSize = 20
header.TextColor3 = Color3.fromRGB(90, 160, 255)
header.BackgroundColor3 = Color3.fromRGB(30, 30, 45)
Instance.new("UICorner", header).CornerRadius = UDim.new(0, 12)

-- Collapse
local collapsed = false
local content = Instance.new("Frame", frame)
content.Position = UDim2.new(0, 0, 0, 50)
content.Size = UDim2.new(1, 0, 1, -50)
content.BackgroundTransparency = 1

-- Close Button
local close = Instance.new("TextButton", frame)
close.Size = UDim2.new(0, 30, 0, 30)
close.Position = UDim2.new(1, -35, 0, 10)
close.Text = "X"
close.BackgroundColor3 = Color3.fromRGB(180, 50, 50)
close.TextColor3 = Color3.new(1, 1, 1)
close.Font = Enum.Font.GothamBold
close.TextSize = 14
Instance.new("UICorner", close).CornerRadius = UDim.new(1, 0)

local farming = false
local farmConnection = nil

close.MouseButton1Click:Connect(function()
    farming = false
    if farmConnection then farmConnection:Disconnect() end
    gui:Destroy()
end)

-- Collapse Button
local collapse = Instance.new("TextButton", frame)
collapse.Size = UDim2.new(0, 30, 0, 30)
collapse.Position = UDim2.new(1, -70, 0, 10)
collapse.Text = "_"
collapse.BackgroundColor3 = Color3.fromRGB(80, 80, 100)
collapse.TextColor3 = Color3.new(1, 1, 1)
collapse.Font = Enum.Font.GothamBold
collapse.TextSize = 16
Instance.new("UICorner", collapse).CornerRadius = UDim.new(1, 0)

collapse.MouseButton1Click:Connect(function()
    collapsed = not collapsed
    if collapsed then
        TweenService:Create(frame, TweenInfo.new(0.3), {Size = UDim2.new(0, 420, 0, 60)}):Play()
        TweenService:Create(content, TweenInfo.new(0.3), {BackgroundTransparency = 1}):Play()
        for _, child in ipairs(content:GetChildren()) do
            if child:IsA("GuiObject") then
                TweenService:Create(child, TweenInfo.new(0.3), {
                    BackgroundTransparency = 1,
                    TextTransparency = 1
                }):Play()
            end
        end
    else
        TweenService:Create(frame, TweenInfo.new(0.3), {Size = UDim2.new(0, 420, 0, 360)}):Play()
        TweenService:Create(content, TweenInfo.new(0.3), {BackgroundTransparency = 0}):Play()
        for _, child in ipairs(content:GetChildren()) do
            if child:IsA("GuiObject") then
                TweenService:Create(child, TweenInfo.new(0.3), {
                    BackgroundTransparency = 0,
                    TextTransparency = 0
                }):Play()
            end
        end
    end
end)

-- Skill toggle
local skills = {
    ["Fist Strength"] = false,
    ["Body Toughness"] = false,
    ["Psychic Power"] = false
}
local activeCount = 0

local function createToggle(skillName, yPosition)
    local holder = Instance.new("Frame", content)
    holder.Size = UDim2.new(0, 360, 0, 40)
    holder.Position = UDim2.new(0, 30, 0, yPosition)
    holder.BackgroundTransparency = 1

    local label = Instance.new("TextLabel", holder)
    label.Size = UDim2.new(1, -70, 1, 0)
    label.Text = skillName
    label.TextColor3 = Color3.new(1, 1, 1)
    label.BackgroundTransparency = 1
    label.Font = Enum.Font.Gotham
    label.TextSize = 16
    label.TextXAlignment = Enum.TextXAlignment.Left

    local switch = Instance.new("Frame", holder)
    switch.Size = UDim2.new(0, 50, 0, 25)
    switch.Position = UDim2.new(1, -60, 0.5, -12)
    switch.BackgroundColor3 = Color3.fromRGB(80, 80, 100)
    Instance.new("UICorner", switch).CornerRadius = UDim.new(1, 0)

    local thumb = Instance.new("Frame", switch)
    thumb.Size = UDim2.new(0, 20, 0, 20)
    thumb.Position = UDim2.new(0, 3, 0.5, -10)
    thumb.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    Instance.new("UICorner", thumb).CornerRadius = UDim.new(1, 0)

    local function toggle()
        if skills[skillName] then
            skills[skillName] = false
            activeCount -= 1
            TweenService:Create(thumb, TweenInfo.new(0.2), {Position = UDim2.new(0, 3, 0.5, -10)}):Play()
            switch.BackgroundColor3 = Color3.fromRGB(80, 80, 100)
        elseif activeCount < 3 then
            skills[skillName] = true
            activeCount += 1
            TweenService:Create(thumb, TweenInfo.new(0.2), {Position = UDim2.new(1, -23, 0.5, -10)}):Play()
            switch.BackgroundColor3 = Color3.fromRGB(60, 180, 90)
        end
    end

    switch.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            toggle()
        end
    end)
end

createToggle("Fist Strength", 20)
createToggle("Body Toughness", 70)
createToggle("Psychic Power", 120)

-- Farm toggle button
local toggleFarm = Instance.new("TextButton", content)
toggleFarm.Size = UDim2.new(0, 360, 0, 45)
toggleFarm.Position = UDim2.new(0, 30, 0, 190)
toggleFarm.BackgroundColor3 = Color3.fromRGB(90, 130, 255)
toggleFarm.TextColor3 = Color3.new(1, 1, 1)
toggleFarm.Font = Enum.Font.GothamBold
toggleFarm.TextSize = 16
toggleFarm.Text = "[ ] Start Farming"
Instance.new("UICorner", toggleFarm).CornerRadius = UDim.new(0, 10)

toggleFarm.MouseButton1Click:Connect(function()
    farming = not farming
    toggleFarm.Text = farming and "[âœ”] Farming Active" or "[ ] Start Farming"
    toggleFarm.BackgroundColor3 = farming and Color3.fromRGB(40, 160, 60) or Color3.fromRGB(90, 130, 255)

    if farming then
        farmConnection = RunService.Heartbeat:Connect(function()
            for _, tool in ipairs(backpack:GetChildren()) do
                for skill, enabled in pairs(skills) do
                    if enabled and tool.Name:lower():find(skill:lower()) then
                        tool.Parent = character
                        pcall(function() tool:Activate() end)
                        wait(0.1)
                        tool.Parent = backpack
                    end
                end
            end
        end)
    elseif farmConnection then
        farmConnection:Disconnect()
        farmConnection = nil
    end
end)
